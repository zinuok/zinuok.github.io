{{/* =========================
   Authors (keep it simple)
   ========================= */}}

{{ $authors := .Params.authors }}

{{ if $authors }}
<div class="authors">
  {{ range $i, $a := $authors }}
    <span class="author">{{ $a | markdownify }}</span>{{ if lt $i (sub (len $authors) 1) }}, {{ end }}
  {{ end }}
</div>
{{ end }}

{{/* =========================
   Equal contribution legend (create)
   ========================= */}}

{{ $has_equal := false }}
{{ with .Params.author_notes }}
  {{ range . }}
    {{ if eq . "Equal contribution" }}{{ $has_equal = true }}{{ end }}
  {{ end }}
{{ end }}

{{ if $has_equal }}
<div id="equal-contrib-legend" style="font-size:0.85em; margin-top:0.25em; line-height:1.3;">
  (* Equal contribution)
</div>
{{ end }}

<script>
document.addEventListener('DOMContentLoaded', function () {
  // ---- move legend after publication line (if present) ----
  const legend = document.getElementById('equal-contrib-legend');
  if (legend) {
    const pub =
      document.querySelector('.pub-publication') ||
      document.querySelector('[class*="pub-publication"]');
    if (pub && pub.parentNode) pub.insertAdjacentElement('afterend', legend);
  }

  // ---- remove "(YYYY)." that appears right before the title link ----
  // Works even if it's not at the start of the paragraph (e.g., "Advisor ... (2025). <a>Title</a> ...")
  document.querySelectorAll('a[href*="/publication/"]').forEach(a => {
    const p = a.parentNode;
    if (!p) return;

    // Look at text nodes right before the anchor
    let n = a.previousSibling;
    while (n) {
      if (n.nodeType === Node.TEXT_NODE) {
        // remove any occurrences of "(YYYY)." in that text node
        n.textContent = n.textContent.replace(/\(\d{4}\)\.\s*/g, '');
        // if the text becomes empty whitespace, keep going
      }
      // stop once we've passed a couple nodes (avoid touching far away text)
      if (n.nodeType === Node.ELEMENT_NODE) break;
      n = n.previousSibling;
    }
  });

  // ---- fallback: if some pages render "(YYYY)." as its own tiny element ----
  document.querySelectorAll('span, strong, em').forEach(el => {
    const t = (el.textContent || '').trim();
    if (/^\(\d{4}\)\.\s*$/.test(t)) el.remove();
  });
});
</script>
