{{ $authors := .Params.authors }}

{{ if $authors }}
<div class="authors">
  {{ range $i, $a := $authors }}
    <span class="author">{{ $a | markdownify }}</span>{{ if lt $i (sub (len $authors) 1) }}, {{ end }}
  {{ end }}
</div>
{{ end }}

{{ $has_equal := false }}
{{ with .Params.author_notes }}
  {{ range . }}
    {{ if eq . "Equal contribution" }}{{ $has_equal = true }}{{ end }}
  {{ end }}
{{ end }}

{{ if $has_equal }}
<div id="equal-contrib-legend" style="font-size:0.85em; margin-top:0.25em; line-height:1.3;">
  (* Equal contribution)
</div>
{{ end }}

<script>
document.addEventListener('DOMContentLoaded', function () {
  // ---- move legend after publication line (if present) ----
  const legend = document.getElementById('equal-contrib-legend');
  if (legend) {
    const pub =
      document.querySelector('.pub-publication') ||
      document.querySelector('[class*="pub-publication"]');
    if (pub && pub.parentNode) pub.insertAdjacentElement('afterend', legend);
  }

  // ---- remove "(YYYY)." right before the title link ----
  document.querySelectorAll('a[href*="/publication/"]').forEach(a => {
    let n = a.previousSibling;
    while (n) {
      if (n.nodeType === Node.TEXT_NODE) {
        n.textContent = n.textContent.replace(/\(\d{4}\)\.\s*/g, '');
      }
      if (n.nodeType === Node.ELEMENT_NODE) break;
      n = n.previousSibling;
    }
  });

  // ---- add line break between Title and Publication ----
  document.querySelectorAll('a[href*="/publication/"]').forEach(a => {
    if (a.nextSibling && a.nextSibling.nodeName === 'BR') return;
    const br = document.createElement('br');
    a.insertAdjacentElement('afterend', br);
  });

  // ---- fallback: remove tiny element that is exactly "(YYYY)." ----
  document.querySelectorAll('span, strong, em').forEach(el => {
    const t = (el.textContent || '').trim();
    if (/^\(\d{4}\)\.\s*$/.test(t)) el.remove();
  });
});
</script>
